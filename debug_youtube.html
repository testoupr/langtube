<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Debug - Real Quiz Data</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .debug-section {
            background: white;
            padding: 2rem;
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .debug-title {
            color: #1e293b;
            margin-bottom: 1rem;
        }
        .debug-url {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            margin: 1rem 0;
            word-break: break-all;
            font-size: 0.9rem;
        }
        .debug-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }
        .debug-error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .debug-info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        .console-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç YouTube Debug - Real Quiz Simulation</h1>
    
    <div class="debug-section">
        <h2 class="debug-title">Simulated Quiz Question with YouTube URL</h2>
        <p>This simulates what happens when the AI returns a quiz question with a YouTube URL:</p>
        
        <div class="debug-url" id="original-url">Loading...</div>
        <div id="debug-result" class="debug-result">Processing...</div>
        <div id="console-output" class="console-log">Console output will appear here...</div>
    </div>

    <div class="debug-section">
        <h2 class="debug-title">Test Different URL Formats</h2>
        <button onclick="testUrl('https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=2m30s')">Test: &t=2m30s</button>
        <button onclick="testUrl('https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=150s')">Test: &t=150s</button>
        <button onclick="testUrl('https://youtu.be/dQw4w9WgXcQ?t=90s')">Test: youtu.be</button>
        <button onclick="testUrl('https://www.youtube.com/watch?v=dQw4w9WgXcQ')">Test: No timestamp</button>
    </div>

    <script>
        // Copy the exact functions from your app.js
        function extractVideoIdFromUrl(url) {
            console.log('üîç Extracting video ID from:', url);
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
                /^([a-zA-Z0-9_-]{11})$/, // Direct video ID
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    console.log('‚úÖ Video ID found:', match[1]);
                    return match[1];
                }
            }
            console.log('‚ùå No video ID found');
            return null;
        }

        function extractTimestampFromUrl(url) {
            console.log('üïê Extracting timestamp from:', url);
            
            // Handle MMmSSs format (e.g., &t=2m30s)
            const mmssMatch = url.match(/[?&]t=(\d+)m(\d+)s/);
            if (mmssMatch) {
                const minutes = parseInt(mmssMatch[1]);
                const seconds = parseInt(mmssMatch[2]);
                const result = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                console.log('‚úÖ MMmSSs format found:', result);
                return result;
            }
            
            // Handle seconds format (e.g., &t=150s or &t=150)
            const secondsMatch = url.match(/[?&]t=(\d+)s?/);
            if (secondsMatch) {
                const totalSeconds = parseInt(secondsMatch[1]);
                const minutes = Math.floor(totalSeconds / 60);
                const remainingSeconds = totalSeconds % 60;
                const result = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                console.log('‚úÖ Seconds format found:', result);
                return result;
            }
            
            console.log('‚ùå No timestamp found');
            return null;
        }

        function createYouTubeEmbedFromUrl(youtubeUrl) {
            console.log('üé¨ Creating YouTube embed from:', youtubeUrl);
            
            const videoId = extractVideoIdFromUrl(youtubeUrl);
            const timestamp = extractTimestampFromUrl(youtubeUrl);
            
            if (!videoId) {
                console.log('‚ùå No video ID, returning empty embed');
                return '';
            }
            
            // Extract seconds from timestamp for embed
            let startSeconds = 0;
            if (timestamp) {
                const parts = timestamp.split(':').map(Number);
                if (parts.length === 2) {
                    startSeconds = parts[0] * 60 + parts[1];
                }
                console.log('‚è∞ Calculated start seconds:', startSeconds);
            } else {
                // Try to extract seconds directly from URL if timestamp parsing failed
                const directSecondsMatch = youtubeUrl.match(/[?&]t=(\d+)s?/);
                if (directSecondsMatch) {
                    startSeconds = parseInt(directSecondsMatch[1]);
                    console.log('‚è∞ Direct seconds extraction:', startSeconds);
                }
            }
            
            const embedUrl = `https://www.youtube.com/embed/${videoId}?start=${startSeconds}&autoplay=0&rel=0&modestbranding=1`;
            console.log('üîó Final embed URL:', embedUrl);
            
            const embed = `
                <div class="youtube-embed-container">
                    <iframe 
                        width="560" 
                        height="315" 
                        src="${embedUrl}" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                    ${timestamp ? `
                        <div class="timestamp-info">
                            <span class="timestamp-label">Relevant timestamp:</span>
                            <span class="timestamp-value">${timestamp}</span>
                        </div>
                    ` : ''}
                </div>
            `;
            
            console.log('‚úÖ Embed created successfully');
            return embed;
        }

        // Simulate a real quiz question with YouTube URL
        function simulateQuizQuestion() {
            const mockQuestion = {
                question: "What is the main topic discussed in this video?",
                options: ["Option A", "Option B", "Option C", "Option D"],
                correctAnswer: 0,
                explanation: "This is the correct explanation.",
                youtubeUrl: "https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=2m30s"
            };
            
            document.getElementById('original-url').textContent = mockQuestion.youtubeUrl;
            
            // Clear console
            console.clear();
            console.log('üöÄ Starting YouTube embed simulation...');
            
            const youtubeEmbed = createYouTubeEmbedFromUrl(mockQuestion.youtubeUrl);
            
            const result = `
                <h4>üìä Debug Results:</h4>
                <p><strong>Original URL:</strong> ${mockQuestion.youtubeUrl}</p>
                <p><strong>Embed Generated:</strong> ${youtubeEmbed ? 'Yes' : 'No'}</p>
                ${youtubeEmbed ? `
                    <h4>üé¨ Generated Embed:</h4>
                    ${youtubeEmbed}
                ` : '<p style="color: red;">‚ùå No embed generated!</p>'}
            `;
            
            document.getElementById('debug-result').innerHTML = result;
            document.getElementById('debug-result').className = youtubeEmbed ? 'debug-result' : 'debug-result debug-error';
            
            // Show console output
            setTimeout(() => {
                document.getElementById('console-output').textContent = 'Check browser console (F12) for detailed logs';
            }, 100);
        }

        function testUrl(url) {
            console.clear();
            console.log('üß™ Testing URL:', url);
            
            document.getElementById('original-url').textContent = url;
            
            const youtubeEmbed = createYouTubeEmbedFromUrl(url);
            
            const result = `
                <h4>üìä Test Results:</h4>
                <p><strong>URL:</strong> ${url}</p>
                <p><strong>Embed Generated:</strong> ${youtubeEmbed ? 'Yes' : 'No'}</p>
                ${youtubeEmbed ? `
                    <h4>üé¨ Generated Embed:</h4>
                    ${youtubeEmbed}
                ` : '<p style="color: red;">‚ùå No embed generated!</p>'}
            `;
            
            document.getElementById('debug-result').innerHTML = result;
            document.getElementById('debug-result').className = youtubeEmbed ? 'debug-result' : 'debug-result debug-error';
        }

        // Start the simulation when page loads
        window.addEventListener('load', simulateQuizQuestion);
    </script>
</body>
</html>
