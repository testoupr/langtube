<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Embed Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f8fafc;
        }
        .test-section {
            background: white;
            padding: 2rem;
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .test-title {
            color: #1e293b;
            margin-bottom: 1rem;
        }
        .test-url {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            margin: 1rem 0;
            word-break: break-all;
        }
        .test-result {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }
        .test-error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
    </style>
</head>
<body>
    <h1>üéØ YouTube Embed Test Page</h1>
    
    <div class="test-section">
        <h2 class="test-title">Test 1: MMmSSs Format (AI Format)</h2>
        <div class="test-url">https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=2m30s</div>
        <div id="test1-result" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Test 2: Seconds Format</h2>
        <div class="test-url">https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=150s</div>
        <div id="test2-result" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Test 3: No Timestamp</h2>
        <div class="test-url">https://www.youtube.com/watch?v=dQw4w9WgXcQ</div>
        <div id="test3-result" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Test 4: Short URL Format</h2>
        <div class="test-url">https://youtu.be/dQw4w9WgXcQ?t=90s</div>
        <div id="test4-result" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">Test 5: Invalid URL</h2>
        <div class="test-url">https://example.com/not-youtube</div>
        <div id="test5-result" class="test-result">Testing...</div>
    </div>

    <script>
        // Copy the functions from app.js for testing
        function extractVideoIdFromUrl(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
                /^([a-zA-Z0-9_-]{11})$/, // Direct video ID
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            return null;
        }

        function extractTimestampFromUrl(url) {
            // Handle MMmSSs format (e.g., &t=2m30s)
            const mmssMatch = url.match(/[?&]t=(\d+)m(\d+)s/);
            if (mmssMatch) {
                const minutes = parseInt(mmssMatch[1]);
                const seconds = parseInt(mmssMatch[2]);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Handle seconds format (e.g., &t=150s or &t=150)
            const secondsMatch = url.match(/[?&]t=(\d+)s?/);
            if (secondsMatch) {
                const totalSeconds = parseInt(secondsMatch[1]);
                const minutes = Math.floor(totalSeconds / 60);
                const remainingSeconds = totalSeconds % 60;
                return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
            
            return null;
        }

        function createYouTubeEmbedFromUrl(youtubeUrl) {
            const videoId = extractVideoIdFromUrl(youtubeUrl);
            const timestamp = extractTimestampFromUrl(youtubeUrl);
            
            if (!videoId) {
                return '';
            }
            
            // Extract seconds from timestamp for embed
            let startSeconds = 0;
            if (timestamp) {
                const parts = timestamp.split(':').map(Number);
                if (parts.length === 2) {
                    startSeconds = parts[0] * 60 + parts[1];
                }
            } else {
                // Try to extract seconds directly from URL if timestamp parsing failed
                const directSecondsMatch = youtubeUrl.match(/[?&]t=(\d+)s?/);
                if (directSecondsMatch) {
                    startSeconds = parseInt(directSecondsMatch[1]);
                }
            }
            
            return `
                <div class="youtube-embed-container">
                    <iframe 
                        width="560" 
                        height="315" 
                        src="https://www.youtube.com/embed/${videoId}?start=${startSeconds}&autoplay=0&rel=0&modestbranding=1" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                    ${timestamp ? `
                        <div class="timestamp-info">
                            <span class="timestamp-label">Relevant timestamp:</span>
                            <span class="timestamp-value">${timestamp}</span>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Test cases
        const testCases = [
            {
                id: 'test1-result',
                url: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=2m30s',
                expected: 'Should extract videoId: dQw4w9WgXcQ, timestamp: 2:30, startSeconds: 150'
            },
            {
                id: 'test2-result',
                url: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ&t=150s',
                expected: 'Should extract videoId: dQw4w9WgXcQ, timestamp: 2:30, startSeconds: 150'
            },
            {
                id: 'test3-result',
                url: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                expected: 'Should extract videoId: dQw4w9WgXcQ, no timestamp, startSeconds: 0'
            },
            {
                id: 'test4-result',
                url: 'https://youtu.be/dQw4w9WgXcQ?t=90s',
                expected: 'Should extract videoId: dQw4w9WgXcQ, timestamp: 1:30, startSeconds: 90'
            },
            {
                id: 'test5-result',
                url: 'https://example.com/not-youtube',
                expected: 'Should return empty string (no videoId)'
            }
        ];

        // Run tests
        testCases.forEach(testCase => {
            const resultEl = document.getElementById(testCase.id);
            
            try {
                const videoId = extractVideoIdFromUrl(testCase.url);
                const timestamp = extractTimestampFromUrl(testCase.url);
                const embed = createYouTubeEmbedFromUrl(testCase.url);
                
                let startSeconds = 0;
                if (timestamp) {
                    const parts = timestamp.split(':').map(Number);
                    if (parts.length === 2) {
                        startSeconds = parts[0] * 60 + parts[1];
                    }
                }
                
                const result = `
                    <h4>‚úÖ Test Results:</h4>
                    <p><strong>Video ID:</strong> ${videoId || 'null'}</p>
                    <p><strong>Timestamp:</strong> ${timestamp || 'null'}</p>
                    <p><strong>Start Seconds:</strong> ${startSeconds}</p>
                    <p><strong>Embed Generated:</strong> ${embed ? 'Yes' : 'No'}</p>
                    <p><strong>Expected:</strong> ${testCase.expected}</p>
                    ${embed ? `
                        <h4>üé¨ Generated Embed:</h4>
                        ${embed}
                    ` : ''}
                `;
                
                resultEl.innerHTML = result;
                resultEl.className = embed ? 'test-result' : 'test-result test-error';
                
            } catch (error) {
                resultEl.innerHTML = `
                    <h4>‚ùå Test Failed:</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Expected:</strong> ${testCase.expected}</p>
                `;
                resultEl.className = 'test-result test-error';
            }
        });
    </script>
</body>
</html>
